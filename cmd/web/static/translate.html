<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>Hermes translate</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    textarea {
      width: 100%;
      height: 100px;
      margin: 10px 0;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>

<body>

  <h1>ğŸŒ Hermes translate</h1>

  <label for="inputText">è¾“å…¥è¯­è¨€/Input Languageï¼š</label>
  <textarea id="inputText" placeholder="è¯·è¾“å…¥éœ€è¦ç¿»è¯‘çš„å†…å®¹/your language"></textarea>

  <label for="outputText">è¾“å‡ºè¯­è¨€/Output Languageï¼š</label>
  <textarea id="outputText" placeholder="ç¿»è¯‘ç»“æœå°†åœ¨æ­¤æ˜¾ç¤º/translate result" readonly></textarea>

  <button onclick="translateText()">ç¿»è¯‘ Translate</button>

  <script>
    async function translateText() {
      const inputText = document.getElementById("inputText").value;

      if (!inputText.trim()) {
        alert("è¯·è¾“å…¥å†…å®¹");
        return;
      }

      try {
        // è·å–ç”¨æˆ·åœ°ç†ä½ç½®
        navigator.geolocation.getCurrentPosition(async (position) => {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;

          // POST è¯·æ±‚ä½“
          const payload = {
            text: inputText,
            location: {
              latitude,
              longitude
            }
          };

          // è°ƒç”¨ Web APIï¼Œè®¾ç½®è¶…æ—¶
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 60000); // 60ç§’è¶…æ—¶

          const response = await fetch("http://localhost:8080/translate", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(payload),
            signal: controller.signal
          });

          clearTimeout(timeoutId);

          const result = await response.json();

          if (response.ok && result.code) {
            document.getElementById("outputText").value = result.message;
          } else if (response.ok && result[0].code) {
            document.getElementById("outputText").value = result[0].message;
          } else {
            document.getElementById("outputText").value = "ç¿»è¯‘å¤±è´¥ï¼š" + (result.error || "æœªçŸ¥é”™è¯¯");
          }

        }, (error) => {
          alert("æ— æ³•è·å–åœ°ç†ä½ç½®ï¼š" + error.message);
        });

      } catch (err) {
        console.error(err);
        alert("å‘ç”Ÿé”™è¯¯ï¼š" + err.message);
      }
    }
  </script>

</body>

</html>